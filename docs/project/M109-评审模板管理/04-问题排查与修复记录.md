# 评审模板管理：问题排查与修复记录

本文记录「评审模板管理」模块在开发/联调过程中出现的典型问题、定位思路与修复方案，供后续同类页面复用。

## 1. 编辑页/详情页“内容只占半屏”

### 现象
- 详情页：评分项全部折叠后，内容区域看起来只占页面一部分（像被压成半屏）。
- 编辑页：第一步（基本信息）显示时，内容宽度明显变窄；而新增页正常。

### 根因
`pages/Edit.vue`、`pages/Detail.vue` 外层使用了 Arco 的 `<a-spin>`，其根节点默认是 `inline-block`，会发生 **shrink-to-fit**：当内部内容变少（例如折叠后）时，容器宽度随之收缩，从而产生“半屏”的视觉效果。

新增页没有 `<a-spin>` 包裹，所以一直是全宽。

### 修复
给 `<a-spin>` 增加全宽样式（块级 + `width: 100%`），避免随内容收缩。

涉及文件：
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Edit.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Detail.vue`

## 2. 步骤条状态异常（第二步显示第一步、第一步不高亮）

### 现象
- 新增/编辑页面上方步骤条与实际显示的 Step 内容不一致。

### 根因
Arco `a-steps` 的 `current` 是 **从 1 开始**计数；但页面之前用 `0/1` 来控制 `v-show` 与按钮显示，导致步骤条与内容错位。

### 修复
统一将页面步骤索引改为 `1/2`，并同步调整：
- Step 内容 `v-show`
- “上一步/下一步/提交”按钮的条件

涉及文件：
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Create.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Edit.vue`

## 3. 总分校验失效（多少分都能保存通过）

### 现象
评分项满分之和不等于模板总分，也能点击保存并通过前端校验。

### 根因
`useTemplateForm()` 中 `isFormValid` 是 `computed()` 返回的 **Ref**，正确用法应为 `isFormValid.value`。
页面提交与按钮禁用逻辑若写成 `!formState.isFormValid`，会因为对象恒为 truthy 导致校验失效。

### 修复
所有引用处统一改为 `formState.isFormValid.value`。

涉及文件：
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Create.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Edit.vue`

## 4. 评分项配置：左侧大类文字换行/右侧操作列“删除”需要横向滚动才能看到

### 现象
- 左侧大类名称较长会折到第二行，不美观。
- 右侧评分项表格操作列宽度不足，导致“删除”按钮需要横向滚动才可见。

### 修复
1) 调整左右栏比例，让左侧获得更多空间。
2) 左侧大类名称增加 `ellipsis`（单行省略）样式，避免换行。
3) 右侧表格启用 `table-layout-fixed` 并给关键列设定宽度，避免内容把操作列挤出可视区。

涉及文件：
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/components/ScoringItemsStep.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/components/CategoryPanel.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/components/ItemPanel.vue`

## 5. “临时页”标签/面包屑处理（新增/编辑/详情）

### 目标
新增/编辑/详情属于短暂页面，完成操作后希望不长期占用顶部页签（Tabs）。面包屑是否展示，建议由菜单/路由元数据统一控制。

### 当前实现（前端侧兜底）
- 从新增/编辑/详情返回列表时，主动关闭自身页签（避免常驻）。
- 对后端未返回 `showInTabs` 的情况，前端默认：隐藏路由不进入 Tabs。

涉及文件：
- `continew-admin-ui/src/stores/modules/route.ts`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Create.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Edit.vue`
- `continew-admin-ui/src/views/projectReviewManagementSystem/systemConfigurationManagement/template/evaluationTemplate/pages/Detail.vue`

> 下一步建议：在「菜单管理」增加“是否显示面包屑”的配置项（后端落表 + 返回路由 meta），前端以 `meta.breadcrumb` 统一判断，避免每个页面手动处理。

