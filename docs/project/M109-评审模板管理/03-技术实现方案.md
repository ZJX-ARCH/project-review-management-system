# M109 评审模板管理 - 技术实现方案

> 基于 ContiNew Admin 框架的主子表业务实现方案
> 创建时间：2025-12-20

---

## 一、整体架构设计

### 1.1 技术栈

**后端技术栈**：
- **框架**：Spring Boot 3.3.12 + ContiNew Starter 2.14.0
- **ORM**：MyBatis Plus 3.5.12
- **权限**：Sa-Token 1.44.0
- **工具**：Lombok 1.18.36 + Hutool 5.8.38
- **接口文档**：Knife4j 4.5.0

**前端技术栈**：
- **框架**：Vue 3.5.4 + TypeScript 5.0.4
- **UI 组件库**：Arco Design 2.57.0
- **状态管理**：Pinia 2.0.16
- **HTTP 客户端**：Axios 0.27.2

### 1.2 模块定位

- **模块名称**：prms-continew-config（项目评审管理系统-配置管理模块）
- **包路径**：`top.continew.admin.config.template`
- **前端路径**：`views/projectReviewManagementSystem/systemConfigurationManagement/template`
- **API 路径**：`/api/config/evaluation-template`

### 1.3 核心挑战

**主子表数据管理**：
- 主表：`prj_evaluation_template`（评审模板）
- 子表：`prj_evaluation_template_item`（评分项）
- 关系：一对多（一个模板包含多个评分项）
- 难点：前端动态表单 + 后端事务一致性

---

## 二、后端实现方案

### 2.1 目录结构设计

```
prms-continew-config/
└── src/main/java/top/continew/admin/config/template/
    ├── controller/
    │   └── EvaluationTemplateController.java          # 控制器
    ├── service/
    │   ├── EvaluationTemplateService.java             # 服务接口
    │   ├── EvaluationTemplateItemService.java         # 评分项服务接口
    │   └── impl/
    │       ├── EvaluationTemplateServiceImpl.java     # 服务实现
    │       └── EvaluationTemplateItemServiceImpl.java # 评分项服务实现
    ├── mapper/
    │   ├── EvaluationTemplateMapper.java              # 主表 Mapper
    │   └── EvaluationTemplateItemMapper.java          # 子表 Mapper
    └── model/
        ├── entity/
        │   ├── EvaluationTemplateDO.java              # 主表实体
        │   └── EvaluationTemplateItemDO.java          # 子表实体
        ├── req/
        │   ├── EvaluationTemplateQuery.java           # 查询条件
        │   ├── EvaluationTemplateReq.java             # 新增/修改请求
        │   └── EvaluationTemplateCopyReq.java         # 复制请求
        ├── resp/
        │   ├── EvaluationTemplateResp.java            # 列表响应
        │   └── EvaluationTemplateDetailResp.java      # 详情响应
        └── vo/
            └── EvaluationTemplateItemVO.java          # 评分项值对象
```

### 2.2 实体类设计思路

#### 2.2.1 主表实体（EvaluationTemplateDO）

**继承关系**：
- 继承 `BaseDO`（框架提供的基类，包含 id、createUser、createTime 等字段）

**核心字段**：
```
- code: String (模板编码，唯一索引)
- name: String (模板名称)
- description: String (模板说明)
- totalScore: BigDecimal (总分，固定100.00)
- itemCount: Integer (评分项数量，冗余字段)
- categoryCount: Integer (评分大类数量，冗余字段)
- status: DisEnableStatusEnum (状态：启用/停用)
- sort: Integer (排序)
```

**注解使用**：
- `@TableName("prj_evaluation_template")`：指定表名
- `@Data`：Lombok 生成 getter/setter
- 字段上使用 `@TableField` 配置特殊映射

#### 2.2.2 子表实体（EvaluationTemplateItemDO）

**继承关系**：
- 继承 `BaseDO`

**核心字段**：
```
- templateId: Long (模板ID，外键)
- categoryName: String (大类名称)
- categorySort: Integer (大类排序)
- itemName: String (评分项名称)
- itemSort: Integer (评分项排序)
- maxScore: BigDecimal (满分值)
- description: String (评分说明)
```

**注解使用**：
- `@TableName("prj_evaluation_template_item")`

### 2.3 请求/响应对象设计思路

#### 2.3.1 EvaluationTemplateReq（新增/修改请求）

**核心设计**：
```
- 基本信息字段（code、name、description、status）
- items: List<EvaluationTemplateItemVO>（评分项列表）
```

**校验注解**：
- `@NotBlank`：code、name 必填
- `@Valid`：级联校验 items 列表
- 自定义校验器：TotalScoreValidator（校验总分是否等于100）

#### 2.3.2 EvaluationTemplateDetailResp（详情响应）

**核心设计**：
```
- 基本信息字段
- items: List<EvaluationTemplateItemVO>（评分项列表，按大类和排序分组）
```

**数据组装思路**：
- 查询主表数据
- 查询子表数据（按 categorySort、itemSort 排序）
- 组装成嵌套结构返回前端

### 2.4 Service 层设计思路

#### 2.4.1 EvaluationTemplateService 接口

**继承关系**：
```java
public interface EvaluationTemplateService
    extends BaseService<EvaluationTemplateResp, EvaluationTemplateDetailResp,
                        EvaluationTemplateQuery, EvaluationTemplateReq>,
            IService<EvaluationTemplateDO>
```

**扩展方法**：
```
- copy(Long id, EvaluationTemplateCopyReq req): Long  // 复制模板
```

#### 2.4.2 主子表事务处理思路

**新增流程**：
1. 开启事务（@Transactional）
2. 校验总分是否等于 100
3. 校验模板编码是否重复
4. 保存主表数据（获取主表 ID）
5. 批量保存子表数据（设置 templateId）
6. 更新主表的 itemCount 和 categoryCount
7. 提交事务

**修改流程**：
1. 开启事务
2. 校验总分是否等于 100
3. 查询原主表数据
4. 更新主表数据
5. **删除原子表数据**（按 templateId 删除）
6. 批量插入新子表数据
7. 更新主表的 itemCount 和 categoryCount
8. 提交事务

**删除流程**：
1. 检查是否被项目类型关联（预留）
2. 删除主表数据
3. 级联删除子表数据（使用 MyBatis Plus 的级联删除）

**复制流程**：
1. 查询原模板详情（包含评分项）
2. 生成新模板编码
3. 复制主表数据（修改 code、name）
4. 复制子表数据（生成新 ID）
5. 保存新模板

### 2.5 Controller 层设计思路

**继承关系**：
```java
@RestController
@CrudRequestMapping(value = "/api/config/evaluation-template",
                    api = {Api.LIST, Api.GET, Api.CREATE, Api.UPDATE, Api.DELETE})
public class EvaluationTemplateController
    extends BaseController<EvaluationTemplateService,
                           EvaluationTemplateResp,
                           EvaluationTemplateDetailResp,
                           EvaluationTemplateQuery,
                           EvaluationTemplateReq>
```

**扩展接口**：
```
POST   /api/config/evaluation-template/{id}/copy  // 复制模板
```

**权限注解**：
- `@SaCheckPermission("config:template:create")`
- `@SaCheckPermission("config:template:update")`
- `@SaCheckPermission("config:template:delete")`

### 2.6 Mapper XML 设计思路

#### 2.6.1 主表 Mapper

**常规 CRUD**：使用 MyBatis Plus 自动生成

**自定义查询**：
- 分页查询（关联项目类型显示名称）
- 统计评分项数量、大类数量

#### 2.6.2 子表 Mapper

**批量操作**：
- `batchInsert(List<EvaluationTemplateItemDO>)`：批量插入
- `deleteByTemplateId(Long templateId)`：按模板ID删除
- `listByTemplateId(Long templateId)`：按模板ID查询

**排序查询**：
```sql
ORDER BY category_sort ASC, item_sort ASC
```

---

## 三、前端实现方案

### 3.1 目录结构设计

```
continew-admin-ui/src/views/projectReviewManagementSystem/
└── systemConfigurationManagement/
    └── template/
        ├── index.vue                    # 列表页（主页面）
        ├── components/
        │   ├── AddModal.vue            # 新增/编辑弹窗
        │   ├── DetailDrawer.vue        # 详情抽屉
        │   ├── CategoryCard.vue        # 评分大类卡片组件
        │   └── ScoreItemCard.vue       # 评分项卡片组件
        └── hooks/
            └── useTemplateForm.ts      # 表单逻辑 Hook
```

### 3.2 列表页设计思路（index.vue）

#### 3.2.1 页面布局

**使用组件**：
- `<a-card>`：页面容器
- `<a-row>` + `<a-col>`：搜索栏布局
- `<a-table>`：列表展示
- `<a-pagination>`：分页

**搜索条件**：
- 模板名称：`<a-input>` 模糊搜索
- 状态：`<a-select>` 下拉选择（全部/启用/停用）

**列表字段**：
| 列名 | 组件 | 说明 |
|-----|------|------|
| 模板编码 | 文本 | 显示 code |
| 模板名称 | 加粗文本 | 显示 name |
| 评分项数量 | Badge | 显示 "8项（5大类）" |
| 总分 | Tag | 固定显示 "100分" |
| 关联项目类型 | 文本 | 显示项目类型名称（预留） |
| 状态 | `<a-badge>` | 启用（绿色）/停用（灰色） |
| 操作 | 按钮组 | 编辑、查看、复制 |

#### 3.2.2 操作按钮

**新建按钮**：
- 位置：搜索栏右侧
- 权限：`v-permission="['config:template:create']"`
- 点击：打开新增弹窗

**行操作按钮**：
- **编辑**：权限 `config:template:update`，打开编辑弹窗
- **查看详情**：权限 `config:template:get`，打开详情抽屉
- **复制**：权限 `config:template:create`，打开复制弹窗并预填充数据

**删除按钮**：
- 使用 `<a-popconfirm>` 二次确认
- 权限：`config:template:delete`

### 3.3 新增/编辑弹窗设计思路（AddModal.vue）

#### 3.3.1 弹窗布局

**使用组件**：
- `<a-modal>`：弹窗容器
  - `width: 1200px`（大弹窗，容纳动态表单）
  - `fullscreen: true`（支持全屏）
- `<a-form>`：表单容器
  - `layout: "vertical"`（垂直布局）

#### 3.3.2 基本信息区域

**表单项**：
1. **模板编码**（必填）
   - 组件：`<a-input>`
   - 规则：格式校验（TPL_XXX）
   - 编辑模式：只读（readonly + 灰色背景）

2. **模板名称**（必填）
   - 组件：`<a-input>`
   - 最大长度：50

3. **模板说明**
   - 组件：`<a-textarea>`
   - 最大长度：500
   - rows: 3

4. **状态**（必填）
   - 组件：`<a-radio-group>`
   - 选项：启用、停用

#### 3.3.3 总分显示区域（关键设计）

**设计思路**：
- 使用粘性定位（sticky）固定在页面顶部
- 实时计算并显示总分
- 根据总分值显示不同颜色

**实现组件**：
```vue
<div class="total-score-card" :class="totalScoreClass">
  <div class="score-label">当前总分</div>
  <div class="score-value">{{ calculatedTotalScore }}</div>
  <div class="score-hint">（必须等于100分）</div>
</div>
```

**颜色逻辑**：
- 总分 = 100：绿色背景（#f6ffed，边框 #52c41a）
- 总分 > 100：红色背景（#fff1f0，边框 #ff4d4f）
- 总分 < 100：黄色背景（#fffbe6，边框 #faad14）

#### 3.3.4 评分项配置区域（核心难点）

**整体设计思路**：
- 使用响应式数组管理评分大类列表
- 每个大类包含评分项数组
- 支持动态添加/删除大类和评分项

**数据结构**：
```typescript
interface ScoreCategory {
  id: string                    // 临时ID（用于Vue key）
  categoryName: string          // 大类名称
  categorySort: number          // 大类排序
  items: ScoreItem[]           // 评分项列表
}

interface ScoreItem {
  id: string                    // 临时ID
  itemName: string              // 评分项名称
  itemSort: number              // 评分项排序
  maxScore: number              // 满分值
  description: string           // 评分说明
}

const categories = ref<ScoreCategory[]>([])
```

**大类卡片组件（CategoryCard.vue）**：

**布局**：
- 使用 `<a-card>` 卡片容器
- 背景色：#fafafa
- 边框：1px solid #d9d9d9

**头部区域**：
```vue
<template #title>
  <a-input
    v-model="category.categoryName"
    placeholder="输入大类名称（如：一、技术创新性）"
    :style="{ width: '300px', fontWeight: 'bold' }"
  />
  <span class="category-score-badge">
    ({{ categoryTotalScore }}分)
  </span>
</template>

<template #extra>
  <a-space>
    <a-button size="small" @click="addItem">添加评分项</a-button>
    <a-button size="small" status="danger" @click="removeCategory">删除大类</a-button>
  </a-space>
</template>
```

**内容区域**：
- 循环渲染 `ScoreItemCard` 组件
- 使用 `<a-row>` + `<a-col>` 布局（每行1-2个卡片）

**评分项卡片组件（ScoreItemCard.vue）**：

**布局**：
- 使用 `<a-card>` 卡片容器
- 背景色：白色
- 边框：1px solid #e8e8e8

**表单项**：
1. **评分项名称**（必填）
   - 组件：`<a-input>`
   - 布局：栅格左侧 50%

2. **满分值**（必填）
   - 组件：`<a-input-number>`
   - 布局：栅格右侧 50%
   - 最小值：0
   - 最大值：100
   - 步长：0.5
   - 精度：1 位小数
   - 变化事件：触发总分重新计算

3. **评分说明**
   - 组件：`<a-textarea>`
   - 布局：独占一行
   - rows: 2

**删除按钮**：
- 位置：卡片右上角
- 图标：`<icon-delete>`
- 点击：二次确认后删除

#### 3.3.5 动态表单逻辑（useTemplateForm.ts）

**核心功能**：

1. **总分实时计算**：
```typescript
const calculatedTotalScore = computed(() => {
  let total = 0
  categories.value.forEach(category => {
    category.items.forEach(item => {
      total += item.maxScore || 0
    })
  })
  return total.toFixed(1)
})
```

2. **大类分数计算**：
```typescript
const getCategoryScore = (category: ScoreCategory) => {
  return category.items.reduce((sum, item) => sum + (item.maxScore || 0), 0)
}
```

3. **添加大类**：
```typescript
const addCategory = () => {
  categories.value.push({
    id: `category_${Date.now()}`,
    categoryName: '',
    categorySort: categories.value.length + 1,
    items: []
  })
}
```

4. **添加评分项**：
```typescript
const addScoreItem = (categoryId: string) => {
  const category = categories.value.find(c => c.id === categoryId)
  if (category) {
    category.items.push({
      id: `item_${Date.now()}`,
      itemName: '',
      itemSort: category.items.length + 1,
      maxScore: 10,
      description: ''
    })
  }
}
```

5. **删除大类/评分项**：
```typescript
const removeCategory = (categoryId: string) => {
  const index = categories.value.findIndex(c => c.id === categoryId)
  if (index > -1) {
    categories.value.splice(index, 1)
  }
}
```

6. **表单提交校验**：
```typescript
const validateForm = (): boolean => {
  // 1. 校验基本信息
  if (!form.code || !form.name) {
    Message.error('请填写模板编码和名称')
    return false
  }

  // 2. 校验至少有一个大类
  if (categories.value.length === 0) {
    Message.error('请至少添加一个评分大类')
    return false
  }

  // 3. 校验每个大类至少有一个评分项
  for (const category of categories.value) {
    if (category.items.length === 0) {
      Message.error(`大类「${category.categoryName}」至少需要一个评分项`)
      return false
    }
  }

  // 4. 校验总分是否等于100
  if (parseFloat(calculatedTotalScore.value) !== 100) {
    Message.error(`当前总分为 ${calculatedTotalScore.value} 分，必须等于100分`)
    return false
  }

  return true
}
```

7. **数据转换**：
```typescript
const transformToRequest = (): EvaluationTemplateReq => {
  const items: EvaluationTemplateItemVO[] = []

  categories.value.forEach((category, cIndex) => {
    category.items.forEach((item, iIndex) => {
      items.push({
        categoryName: category.categoryName,
        categorySort: cIndex + 1,
        itemName: item.itemName,
        itemSort: iIndex + 1,
        maxScore: item.maxScore,
        description: item.description
      })
    })
  })

  return {
    ...form,
    items
  }
}
```

### 3.4 详情抽屉设计思路（DetailDrawer.vue）

**使用组件**：
- `<a-drawer>`：抽屉容器
  - `width: 800px`
  - `placement: "right"`

**布局设计**：
1. **基本信息区域**
   - 使用 `<a-descriptions>` 组件
   - 显示：模板编码、模板名称、模板说明、状态、创建时间

2. **评分项展示区域**
   - 按大类分组显示
   - 只读模式，不可编辑
   - 使用卡片展示（样式与编辑页一致）

**数据加载**：
```typescript
const loadDetail = async (id: string) => {
  const { data } = await getEvaluationTemplateDetail(id)

  // 转换数据结构
  const categoryMap = new Map<string, ScoreCategory>()

  data.items.forEach(item => {
    if (!categoryMap.has(item.categoryName)) {
      categoryMap.set(item.categoryName, {
        categoryName: item.categoryName,
        categorySort: item.categorySort,
        items: []
      })
    }
    categoryMap.get(item.categoryName)!.items.push(item)
  })

  categories.value = Array.from(categoryMap.values())
    .sort((a, b) => a.categorySort - b.categorySort)
}
```

### 3.5 API 接口设计思路

**文件路径**：`src/apis/projectReviewManagementSystem/template.ts`

**接口定义**：
```typescript
// 类型定义
export interface EvaluationTemplateResp {
  id: string
  code: string
  name: string
  description?: string
  totalScore: number
  itemCount: number
  categoryCount: number
  status: number
  createTime: string
}

export interface EvaluationTemplateItemVO {
  categoryName: string
  categorySort: number
  itemName: string
  itemSort: number
  maxScore: number
  description?: string
}

export interface EvaluationTemplateDetailResp extends EvaluationTemplateResp {
  items: EvaluationTemplateItemVO[]
}

export interface EvaluationTemplateReq {
  code: string
  name: string
  description?: string
  status: number
  items: EvaluationTemplateItemVO[]
}

// API 函数
export function listEvaluationTemplate(params: any) {
  return request.get<PageResp<EvaluationTemplateResp>>('/api/config/evaluation-template', { params })
}

export function getEvaluationTemplateDetail(id: string) {
  return request.get<EvaluationTemplateDetailResp>(`/api/config/evaluation-template/${id}`)
}

export function createEvaluationTemplate(data: EvaluationTemplateReq) {
  return request.post('/api/config/evaluation-template', data)
}

export function updateEvaluationTemplate(id: string, data: EvaluationTemplateReq) {
  return request.put(`/api/config/evaluation-template/${id}`, data)
}

export function deleteEvaluationTemplate(id: string) {
  return request.delete(`/api/config/evaluation-template/${id}`)
}

export function copyEvaluationTemplate(id: string, data: { code: string, name: string }) {
  return request.post(`/api/config/evaluation-template/${id}/copy`, data)
}
```

---

## 四、关键技术点设计

### 4.1 主子表事务一致性

**问题**：主表和子表数据必须同时成功或失败

**解决方案**：
1. **后端事务控制**
   - Service 方法添加 `@Transactional(rollbackFor = Exception.class)`
   - 使用 try-catch 捕获异常并回滚
   - 子表操作失败时抛出异常，触发主表回滚

2. **数据库约束**
   - 子表 template_id 字段添加外键约束（可选）
   - 删除主表时级联删除子表（ON DELETE CASCADE）

### 4.2 总分校验

**前端校验**：
- 实时计算并显示总分
- 保存时校验总分是否等于 100
- 提供视觉反馈（颜色提示）

**后端校验**：
- 使用自定义校验器 `TotalScoreValidator`
- 在 Service 层二次校验（防止前端绕过）
- 校验失败抛出 `BusinessException`

### 4.3 动态表单性能优化

**问题**：评分项过多时，表单渲染性能下降

**解决方案**：
1. **虚拟滚动**（可选）
   - 使用 `<a-virtual-list>` 组件
   - 仅渲染可视区域的卡片

2. **防抖处理**
   - 总分计算使用 `computed`（自动缓存）
   - 输入框使用 `v-model.lazy`（失焦时更新）

3. **组件拆分**
   - 大类卡片和评分项卡片独立封装
   - 避免父组件重复渲染

### 4.4 复制功能设计

**前端流程**：
1. 点击复制按钮
2. 加载原模板详情数据
3. 打开新增弹窗并预填充数据
4. 修改模板编码和名称（自动添加 "- 副本" 后缀）
5. 保存新模板

**后端流程**：
1. 查询原模板详情
2. 生成新模板编码（建议用户手动修改）
3. 深拷贝主表和子表数据
4. 插入新数据
5. 返回新模板ID

### 4.5 数据权限控制（预留）

**场景**：不同租户只能看到自己的模板

**实现思路**：
- Entity 添加 `tenantId` 字段
- 使用 MyBatis Plus 的 `TenantLineHandler` 拦截器
- 自动添加租户条件

---

## 五、交互设计细节

### 5.1 加载状态

**列表加载**：
- 使用 `<a-spin>` 包裹列表
- 显示骨架屏（`<a-skeleton>`）

**表单提交**：
- 按钮显示 loading 状态
- 防止重复提交（按钮 disabled）

### 5.2 错误处理

**前端错误提示**：
- 校验错误：`Message.error()` 提示具体错误
- 网络错误：`Message.error('网络异常，请稍后重试')`

**后端异常处理**：
- 业务异常：返回 400 + 错误信息
- 系统异常：返回 500 + 通用错误信息
- 全局异常处理器统一处理

### 5.3 用户体验优化

**保存前确认**：
```typescript
const handleSave = async () => {
  if (!validateForm()) {
    return
  }

  Modal.confirm({
    title: '确认保存',
    content: `确认${mode === 'add' ? '创建' : '更新'}评审模板「${form.name}」？`,
    onOk: async () => {
      await saveTemplate()
    }
  })
}
```

**自动保存草稿**（可选）：
- 使用 localStorage 存储表单数据
- 页面刷新时恢复数据
- 成功保存后清除草稿

**快捷键支持**（可选）：
- `Ctrl + S`：保存
- `Esc`：关闭弹窗

---

## 六、测试策略

### 6.1 后端单元测试

**测试覆盖**：
- Service 层业务逻辑测试
- 主子表事务测试
- 总分校验测试
- 边界条件测试

**Mock 数据**：
- 使用 Mockito Mock Mapper 层
- 准备测试数据集（正常数据、异常数据）

### 6.2 前端单元测试

**测试组件**：
- 总分计算逻辑测试
- 表单校验测试
- 添加/删除大类和评分项测试

**测试框架**：
- Vitest + Vue Test Utils

### 6.3 集成测试

**测试场景**：
- 创建模板完整流程
- 编辑模板完整流程
- 复制模板完整流程
- 删除模板（含级联删除）

### 6.4 手动测试清单

- [ ] 新建模板（各种总分情况：<100、=100、>100）
- [ ] 编辑模板（修改评分项）
- [ ] 复制模板
- [ ] 删除模板
- [ ] 搜索和筛选
- [ ] 权限控制测试
- [ ] 并发操作测试
- [ ] 浏览器兼容性测试

---

## 七、性能优化建议

### 7.1 后端优化

1. **批量操作优化**
   - 子表批量插入使用 MyBatis foreach
   - 避免循环单条插入

2. **查询优化**
   - 列表查询添加索引（status、code）
   - 分页查询避免全表扫描

3. **缓存策略**（可选）
   - 使用 Redis 缓存常用模板数据
   - 缓存过期时间：30 分钟

### 7.2 前端优化

1. **按需加载**
   - 使用 `defineAsyncComponent` 异步加载组件
   - 路由懒加载

2. **图片/资源优化**
   - 图标使用 SVG
   - 减少不必要的网络请求

3. **渲染优化**
   - 大列表使用虚拟滚动
   - 避免不必要的组件重新渲染（使用 `v-memo`）

---

## 八、后续扩展功能

### 8.1 模板导入导出

**导出功能**：
- 导出为 Excel 格式
- 包含基本信息和评分项详情

**导入功能**：
- 使用 Excel 模板批量导入模板
- 校验数据格式和总分

### 8.2 模板版本管理

**需求**：
- 模板修改后保留历史版本
- 支持回滚到旧版本

**实现思路**：
- 新增版本表 `prj_evaluation_template_version`
- 修改模板时创建新版本
- 提供版本对比功能

### 8.3 模板预览

**需求**：
- 以专家视角预览评审表单
- 模拟打分流程

**实现思路**：
- 新增预览弹窗
- 展示只读的评分表单
- 提供模拟打分功能

---

## 九、风险评估与应对

### 9.1 技术风险

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 主子表事务失败 | 数据不一致 | 严格的事务控制 + 异常处理 |
| 前端动态表单性能 | 用户体验差 | 组件拆分 + 虚拟滚动 |
| 总分校验绕过 | 数据错误 | 前后端双重校验 |

### 9.2 业务风险

| 风险 | 影响 | 应对措施 |
|-----|------|---------|
| 模板被项目类型关联后误删 | 业务异常 | 删除前检查关联关系 |
| 并发修改冲突 | 数据覆盖 | 乐观锁（version 字段） |
| 评分项过多导致表单复杂 | 用户困惑 | 提供导入模板功能 + 操作指引 |

---

## 十、开发计划建议

### 阶段一：后端开发（3天）
- Day 1：实体类、Mapper、基础 CRUD
- Day 2：Service 层主子表事务处理
- Day 3：Controller 层、接口文档、单元测试

### 阶段二：前端开发（4天）
- Day 1：列表页、API 接口封装
- Day 2：新增/编辑弹窗基本信息区域
- Day 3：动态表单（评分项配置）
- Day 4：详情抽屉、复制功能、联调测试

### 阶段三：联调与测试（2天）
- Day 1：前后端联调、Bug 修复
- Day 2：集成测试、手动测试、文档完善

**总计**：约 9 个工作日

---

## 十一、参考资料

### 框架文档
- ContiNew Starter：https://continew.top/
- MyBatis Plus：https://baomidou.com/
- Arco Design：https://arco.design/vue

### 技术文章
- Vue 3 动态表单最佳实践
- MyBatis Plus 主子表事务处理
- TypeScript 类型安全实践

---

*文档版本：V1.0*
*最后更新：2025-12-20*
*作者：Claude Code*
